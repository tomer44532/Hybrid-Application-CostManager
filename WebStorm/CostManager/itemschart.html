<!DOCTYPE html>
<html>
<head>
    <title>todo list</title>
    <link rel="stylesheet" href="themes/theme1.min.css" />
    <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.js" type="text/javascript"></script>
    <script src="CostManager.js"></script>
    <script src="Item.js"></script>
</head>
<body>
<div data-role="page" id="home">
    <div data-role="header" >
        <h1>Cost Manager Project</h1>
    </div>
    <div data-role="content">
        <a href="showitems.html"data-ajax="false" data-role="button" data-inline="true" >show items</a>

    </div>
    <h2 id="errorMsg" color=red></h2>
    <label for="startDate">Start date:</label>
    <input type="date" id="startDate" name="trip-start">
    <label for="endDate">End date:</label>
    <input type="date" id="endDate" name="trip-end">
    <br/>
    <input type="button" value="Filter chart" id="filterBtn"/>
    <input type="button" value="Reset chart" id="resetFilterBtn"/>
    <br/>
    <div data-role="footer">
        <h4>   </h4>
    </div>
    <div id="piechart"></div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</div>
<script type="text/javascript">
    // Load google charts
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    // Draw the chart and set the chart values
    function drawChart() {
        var dataArray = [['Category','Purches Amount']];
        var categories = window.CostManager.getCategories();
        for (var n =0; n < categories.length; n++) {
            var amount = parseInt(window.CostManager.getCategoryAmount(categories[n]))
            dataArray.push ([categories[n]+" total cost: "+window.CostManager.getCostPerCategory(categories[n]), amount ])
        }
        // set chart properties
        var options = {'title':'My purches', 'width':200, 'height':200,left:20,top:0,width:'75%',height:'75%'};

        var data = new google.visualization.arrayToDataTable(dataArray);
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }
    window.CostManager.handleFilterButtonClick = function(){//redraw chart with filtered dates
        var startDate = new Date($('#startDate').val());
        var endDate = new Date($('#endDate').val());
        startDate.setHours(0,0,0,0);
        endDate.setHours(0,0,0,0);
        if(startDate <= endDate){
            document.getElementById("errorMsg").innerHTML = "";
            var filteredItems = window.CostManager.filterDates(startDate,endDate);
            var dataArray = [['Category','Purches Amount']];
            var categories = window.CostManager.getCategories();
            for (var n =0; n < categories.length; n++) {
                var amount = parseInt(window.CostManager.getCategoryAmountByDate(categories[n],startDate,endDate))
                dataArray.push ([categories[n]+" total cost: "+window.CostManager.getCostPerCategoryByDate(categories[n],startDate,endDate), amount ])
            }
            // set chart properties
            var options = {'title':'My purches', 'width':200, 'height':200,left:20,top:0,width:'75%',height:'75%'};

            var data = new google.visualization.arrayToDataTable(dataArray);
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data, options);
        }
        else {
            document.getElementById("errorMsg").innerHTML = "Start date must be less then end date";

        }

    }
    document.getElementById("filterBtn").addEventListener("click", window.CostManager.handleFilterButtonClick);


    window.CostManager.resetFilter = function (){//redraw chart without filtered dates
        document.getElementById("errorMsg").innerHTML = "";

        var dataArray = [['Category','Purches Amount']];
        var categories = window.CostManager.getCategories();
        for (var n =0; n < categories.length; n++) {
            var amount = parseInt(window.CostManager.getCategoryAmount(categories[n]))
            dataArray.push ([categories[n]+" total cost: "+window.CostManager.getCostPerCategory(categories[n]), amount ])
        }
        // set chart properties
        var options = {'title':'My purches', 'width':200, 'height':200,left:20,top:0,width:'75%',height:'75%'};

        var data = new google.visualization.arrayToDataTable(dataArray);
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }
    document.getElementById("resetFilterBtn").addEventListener("click", window.CostManager.resetFilter);
</script>
</body>
</html>